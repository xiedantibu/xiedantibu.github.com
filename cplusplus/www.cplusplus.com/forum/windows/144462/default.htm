<!DOCTYPE html><!-- saved from url=(0057)http://www.cplusplus.com/forum/windows/144462/default.htm --><meta http-equiv="X-UA-Compatible" content="IE=Edge" />

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Work around for using C++ class with ext - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">
<link rel="stylesheet" type="text/css" href="../../../v321/main.css">
<script src="../../../v321/main.js" type="text/javascript"></script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="../../../default.htm" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="../../default.htm">Forum</a></li>
<li><a href="../default.htm">Windows Programming</a></li>
<li class="here">Work around for using C++ class with ext</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support"><script type="text/javascript"><!--
if (!cookieGet("hspt31")) {
  document.write('<div class="C_DonateBox"></div>');
}
//-->
</script><div class="C_ad728"><script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7973859818";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div><div class="C_supportbottom"></div></div><div id="I_content">
<h3><div class="C_ico default" title="post">&nbsp;</div> Work around for using C++ class with extern &quot;C&quot; DLL, class, function overloading, templates</h3><span id="CH_edttl"></span><span class="rootdatPost" title="144462,root,0,-1,9,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg761519"><span title="761519,153871,1023,4,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg761519" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm223379bbb0" title="Thu, 09 Oct 2014 17:45:30 +0000"></span><script type="text/javascript">WhenId('CH_zTm223379bbb0');</script><noscript>Oct 9, 2014 at 5:45pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/supracharger/default.htm"><b>supracharger</b> (4)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i761519">
Hello,<br>
   I've been betting my head against the wall trying to figure out how to be able to use all the tools of C++ while having to extern "C" the code to a DLL. <br>
<br>
   I understand name mangling is the issue, which brought me to the thought of having a host, and client DLL to be able to accomplish the task. I also tried to have two programs, a Server and a client, where the client would send the data to the Server program by TCP socket to do the C++ calculations and send the returned value back to the client. However, I found sending data between two programs by a TCP socket to be to slow. <br>
<br>
    So before I make the venture to create a host and client DLL to work around the extern "C" while using the tools of C++. I would like to hear your input, or maybe there is a different path to take.<br>
<br>
However, I feel is it fees-able to use all the tools of C++ while having to extern the code to "C" by having a host and client DLL.<br>
Example is as follows:<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br></code></pre></td>
<td class="source"><pre><code><cite>// FILE: hostDll.dll .....................................................................................</cite>
<cite>// The Host DLL to be able to use the C++ tools</cite>
__declspec(dllexport) <var>double</var> CPPFunction(){
	<cite>// Be able to use function overloading, templates, ect.</cite>
}
<cite>// ........................................................................................................</cite>

<cite>// FILE: clientDll.dll ------------------------------------------------------------------------------</cite>
<cite>// Bring in the Host DLL to be able to use the C++ func while 'extern"C"'</cite>
<var>extern</var> <kbd>"C"</kbd> __declspec(dllimport) <var>double</var> CPPFunction(){
}

<cite>// the Client DLL the sends data to the Host C++ DLL</cite>
<var>extern</var> <kbd>"C"</kbd> __declspec(dllexport) <var>double</var> function(){

	<cite>// Sends the data to the Host DLL, the Host DLL is able to use C++ calc and returns the value</cite>
	<cite>// This way you get the best of both worlds, so you don't have to accomidate with having to use 'extern"C"'</cite>
	<var>return</var> CPPFunction();
}
<cite>// ------------------------------------------------------------------------------------------------------ </cite></code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm261307ba1a" title="Thu, 09 Oct 2014 20:35:02 +0000"></span><script type="text/javascript">WhenId('CH_zTm261307ba1a');</script><noscript>Oct 9, 2014 at 8:35pm UTC</noscript></span>
<span class="dbtn" id="CH_btn761519"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg761527"><span title="761527,17129,1023,7248,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg761527" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm30e4a4c037" title="Thu, 09 Oct 2014 18:05:47 +0000"></span><script type="text/javascript">WhenId('CH_zTm30e4a4c037');</script><noscript>Oct 9, 2014 at 6:05pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/kbw/default.htm"><b>kbw</b> (7248)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i761527">
<table class="quote"><tr><td class="qd">I understand name mangling is the issue, ...</td></tr></table>I don't quite understand what the problem is.<br>
<br>
You can export C++ mangled names from DLLs, the C++ runtime does that, and pretty much everyone else.<br>
<br>
Perhaps if you explained the problem, we may be able to provide a helpful answer.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmf3ffe9b281" title="Thu, 09 Oct 2014 18:06:01 +0000"></span><script type="text/javascript">WhenId('CH_zTmf3ffe9b281');</script><noscript>Oct 9, 2014 at 6:06pm UTC</noscript></span>
<span class="dbtn" id="CH_btn761527"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg761602"><span title="761602,153871,1023,4,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg761602" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm7b744fd675" title="Thu, 09 Oct 2014 20:25:00 +0000"></span><script type="text/javascript">WhenId('CH_zTm7b744fd675');</script><noscript>Oct 9, 2014 at 8:25pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/supracharger/default.htm"><b>supracharger</b> (4)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i761602">
The problem:<br>
is with extern"C". If I have a class written in C++, try to incorporate it in a DLL, and have to use extern"C" woun't the program using this DLL have the potential to get confused because of name mangling.<br>
<br>
So with extern"C" you can NOT overload functions, use templates, ect. from C++, right? So that is why I proposed a work around (the code above). So you could use the C++ tools (templates, func overloading) but be able to extern"C" because I'm using a Host DLL, that uses the C++ tools, imputed into a client DLL that has to use extern"C".<br>
<br>
Would my work around work?<br>
<br>
Also, does that make sense?   
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmf0c368039f" title="Thu, 09 Oct 2014 20:26:34 +0000"></span><script type="text/javascript">WhenId('CH_zTmf0c368039f');</script><noscript>Oct 9, 2014 at 8:26pm UTC</noscript></span>
<span class="dbtn" id="CH_btn761602"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg761639"><span title="761639,13185,1023,1084,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg761639" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm899b912ced" title="Thu, 09 Oct 2014 22:00:49 +0000"></span><script type="text/javascript">WhenId('CH_zTm899b912ced');</script><noscript>Oct 9, 2014 at 10:00pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/freddie1/default.htm"><b>freddie1</b> (1084)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i761639">
No workaround needed.  You can export a class from a Dll and it'll be just the same as having it in the host.  I do that occasionally with my String Class, that is, have the implementation in a dll, and have use of it in a host linked against the dll.  I can provide examples if you like.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn761639"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg761641"><span title="761641,13185,1023,1084,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg761641" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmeeee3b005b" title="Thu, 09 Oct 2014 22:02:58 +0000"></span><script type="text/javascript">WhenId('CH_zTmeeee3b005b');</script><noscript>Oct 9, 2014 at 10:02pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/freddie1/default.htm"><b>freddie1</b> (1084)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i761641">
Only gotcha, is it isn't portable between compilers, because there is nothing that I know of in the C++ Standards that specify what the binary layout of a C++ class looks like.  That's why COM was invented.  So if you create the Dll with GCC, for example, it likely won't work with MSVC.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn761641"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg761661"><span title="761661,153871,1023,4,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg761661" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm29832887f1" title="Thu, 09 Oct 2014 23:14:58 +0000"></span><script type="text/javascript">WhenId('CH_zTm29832887f1');</script><noscript>Oct 9, 2014 at 11:14pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/supracharger/default.htm"><b>supracharger</b> (4)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i761661">
Thank you freddie1 for your answer, right it is not portable with compilers<br>
<br>
<table class="quote"><tr><td class="qd"> That's why COM was invented. So if you create the Dll with GCC, for example, it likely won't work with MSVC. </td></tr></table>  Isn't that why you use extern"C"?<br>
<br>
So if I bring a host DLL into the client DLL, and  the client DLL is the only one with extern"C." Would the program using the client DLL mangle the names in the hostDll (inputed into the clientDLL)  anyway, and my work around would not work, or would it work?
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm15bd827186" title="Thu, 09 Oct 2014 23:15:27 +0000"></span><script type="text/javascript">WhenId('CH_zTm15bd827186');</script><noscript>Oct 9, 2014 at 11:15pm UTC</noscript></span>
<span class="dbtn" id="CH_btn761661"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg762052"><span title="762052,88943,1023,53,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg762052" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm8d9a763b48" title="Fri, 10 Oct 2014 22:47:45 +0000"></span><script type="text/javascript">WhenId('CH_zTm8d9a763b48');</script><noscript>Oct 10, 2014 at 10:47pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/ahcfan/default.htm"><b>ahcfan</b> (53)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i762052">
Doesn't extern "C" remove name mangling? I thought the whole point of extern "C" was to make code compatible with other languages and compilers.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn762052"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg762613"><span title="762613,17129,1023,7248,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg762613" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm95e0410ad3" title="Sun, 12 Oct 2014 11:45:25 +0000"></span><script type="text/javascript">WhenId('CH_zTm95e0410ad3');</script><noscript>Oct 12, 2014 at 11:45am UTC</noscript></div>
<div class="dwho"><a href="../../../user/kbw/default.htm"><b>kbw</b> (7248)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i762613">
<table class="quote"><tr><td class="qd">Doesn't extern "C" remove name mangling?</td></tr></table>Yes it does, but there's more a DLL than name mangling.<br>
<br>
A DLL can export data, functions and classes.  We folk always think exporting data is a bad idea.<br>
<br>
Functions can be exported by name or by ordinal.  It takes longer to search for a function name, than to look up a number.  So back in WIN16, functions were looked up by name because the hardware was so slow.<br>
<br>
It was with great relieve that C++ mangled symbols can be exported as easily as C symbols.  And as long as you're interfacing with C++ systems built from the same mangling scheme, things are ok (heaps aside).<br>
<br>
It turns out that classes can be exported too.  If you look at the runtime libraries for MFC, you'll seem lots of exported classes and their members.<br>
<br>
Finally, it's possible for your DLL to export interfaces with a C factory function.  A C++ client can obtain an interface from the factory and make no further deman on the DLL interface mechanism.<br>
<br>
So what makes this all so vendor specific?<br>
<br>
1. Each vendor typically has their own name mangling scheme.<br>
2. Each vendor typically has their own vtable scheme?<br>
3. Heap arrangements.<br>
<br>
Obviously, if a client cannot understand the naming convention of the code in the DLL, they're incompatible.<br>
<br>
If the client and DLL have different vtable implementations, then they cannot use Object Oriented features; they can use STL but not streams for example.<br>
<br>
Finally, what does <span class="auto"><code class="source"><var>int</var>* a = <var>int</var>(f(x));</code></span> and <span class="auto"><code class="source"><var>delete</var> [] a;</code></span> mean when placed in a header file?  One has to be careful.  Do the new and delete refer to the same heap?  They'd better.  The implementation can go some way to help, but it's not always obvious what's right.<br>
<br>
The operation system's native language is C.  So what if you want to use C++ in a system wide way?  The answer is COM.  With reference to the 3 issues listed above:<br>
<br>
It turns out that classes are identified by GUIDs, large unique numbers.  Methods are offsets within each class.  There's no generalization, only composition.<br>
<br>
Almost coincidentally, the method ordering scheme with a class in COM, matches exactly the vtable scheme in Microsoft's compiler.  Amazing!<br>
<br>
Early COM interfaces supported different heaps (IMalloc), but that idea was dropped for the greater good.<br>
<br>
I think that about covers it.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn762613"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg764227"><span title="764227,153871,1023,4,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg764227" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmdd6b1ce606" title="Thu, 16 Oct 2014 02:41:50 +0000"></span><script type="text/javascript">WhenId('CH_zTmdd6b1ce606');</script><noscript>Oct 16, 2014 at 2:41am UTC</noscript></div>
<div class="dwho"><a href="../../../user/supracharger/default.htm"><b>supracharger</b> (4)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i764227">
Thank you kbw for your various answers to my question.<br>
-Andrew
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn764227"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Registered users can post here. <a href="../../../user/default.htm">Sign in or register</a> to post.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(144462,0,153871,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','../../thread.cgi','../../post.cgi','../../myposts.cgi.htm',64,32,512,256,1024,16);</script></div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7973859818";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="../../../default.htm">C++</a></b></h3>
<ul>
<li class="folder info"><a href="../../../info/default.htm">Information</a></li>
<li class="folder doc"><a href="../../../doc/default.htm">Tutorials</a></li>
<li class="folder reference"><a href="../../../reference/default.htm">Reference</a></li>
<li class="folder articles"><a href="../../../articles/default.htm">Articles</a></li>
<li class="folder selected forum"><a href="../../default.htm">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="../../default.htm">Forum</a></b></h3>
<ul>
<li><a href="../../beginner/default.htm"><b>Beginners</b></a></li><li class="selected"><a href="../default.htm"><b>Windows Programming</b></a></li><li><a href="../../unices/default.htm"><b>UNIX/Linux Programming</b></a></li><li><a href="../../general/default.htm"><b>General C++ Programming</b></a></li><li><a href="../../lounge/default.htm"><b>Lounge</b></a></li><li><a href="../../jobs/default.htm"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="../../../default.htm">Home page</a> | <a href="../../../privacy.do.htm">Privacy policy</a><br>&copy; cplusplus.com, 2000-2014 - All rights reserved - <i>v3.1</i><br><a href="../../../contact.doreferrerwww.cplusplus~510.com_">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="../../../user/default.htm">'+us.user+'</a></b></h3><ul><li><a href="../../myposts.cgi.htm">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? '../../../../httpsssl/default.htm' : '../../../../www/default.htm') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>