<!DOCTYPE html><!-- saved from url=(0057)http://www.cplusplus.com/forum/general/145810/default.htm --><meta http-equiv="X-UA-Compatible" content="IE=Edge" />

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>virtual destructor  - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">
<link rel="stylesheet" type="text/css" href="../../../v321/main.css">
<script src="../../../v321/main.js" type="text/javascript"></script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="../../../default.htm" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="../../default.htm">Forum</a></li>
<li><a href="../default.htm">General C++ Programming</a></li>
<li class="here">virtual destructor </li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support"><script type="text/javascript"><!--
if (!cookieGet("hspt31")) {
  document.write('<div class="C_DonateBox"></div>');
}
//-->
</script><div class="C_ad728"><script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7973859818";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div><div class="C_supportbottom"></div></div><div id="I_content">
<h3><div class="C_ico question" title="question">&nbsp;</div> virtual destructor </h3><span id="CH_edttl"></span><span class="rootdatPost" title="145810,root,0,-1,12,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg767516"><span title="767516,154725,1023,21,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767516" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmf977a007fc" title="Fri, 24 Oct 2014 11:45:48 +0000"></span><script type="text/javascript">WhenId('CH_zTmf977a007fc');</script><noscript>Oct 24, 2014 at 11:45am UTC</noscript></div>
<div class="dwho"><a href="../../../user/sajid_dayer/default.htm"><b>sajid dayer</b> (21)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767516">
class Base<br>
{<br>
public:<br>
    virtual ~Base()<br>
    {<br>
        cout &lt;&lt; "Calling ~Base()" &lt;&lt; endl;<br>
    }<br>
};<br>
 <br>
class Derived: public Base<br>
{<br>
private:<br>
    int* m_pnArray;<br>
 <br>
public:<br>
    Derived(int nLength)<br>
    {<br>
        m_pnArray = new int[nLength];<br>
    }<br>
 <br>
    virtual ~Derived()<br>
    {<br>
        cout &lt;&lt; "Calling ~Derived()" &lt;&lt; endl;<br>
        delete[] m_pnArray;<br>
    }<br>
};<br>
 <br>
int main()<br>
{<br>
    Derived *pDerived = new Derived(5);<br>
    Base *pBase = pDerived;<br>
    delete pBase;<br>
 <br>
    return 0;<br>
}<br>
//  i just want to know that i am calling to base destructor here then why it is calling drive destructor also ?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767516"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767520"><span title="767520,111189,1023,3222,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767520" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmb3a353e294" title="Fri, 24 Oct 2014 11:58:45 +0000"></span><script type="text/javascript">WhenId('CH_zTmb3a353e294');</script><noscript>Oct 24, 2014 at 11:58am UTC</noscript></div>
<div class="dwho"><a href="../../../user/keskiverto/default.htm"><b>keskiverto</b> (3222)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767520">
You call the destructor of the object pointed to by pBase.  That object has type Derived.  Derived has virtual destructor and therefore you do call the Destructor::~Destructor just like you should.  It would be an error to not call it.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767520"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767522"><span title="767522,154725,1023,21,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767522" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm4ced20a8ed" title="Fri, 24 Oct 2014 12:03:41 +0000"></span><script type="text/javascript">WhenId('CH_zTm4ced20a8ed');</script><noscript>Oct 24, 2014 at 12:03pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/sajid_dayer/default.htm"><b>sajid dayer</b> (21)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767522">
i cant understand 
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767522"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767525"><span title="767525,99948,1023,5455,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767525" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmd26edf9ea0" title="Fri, 24 Oct 2014 12:11:34 +0000"></span><script type="text/javascript">WhenId('CH_zTmd26edf9ea0');</script><noscript>Oct 24, 2014 at 12:11pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/miinipaa/default.htm"><b>MiiNiPaa</b> (5455)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767525">
The destructor is virtual. That means that instead of resolving call statically (calling whichever function correspond to pointer type) it resolves it dinamically: though hidden member in class it selects function corresponding to <b>real</b> type of class pointer is pointing to.<br>
So <tt>~Derived</tt> is executed. Destructors of the derived classes call destructors of base class after they finished. So you will see<div class="auto"><table class="snippet"><tr><td class="output"><pre><samp>Calling ~Derived()
Calling ~Base()</samp></pre></td></tr></table></div>in the output.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767525"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767531"><span title="767531,154725,1023,21,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767531" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm2f4031c9a1" title="Fri, 24 Oct 2014 12:27:21 +0000"></span><script type="text/javascript">WhenId('CH_zTm2f4031c9a1');</script><noscript>Oct 24, 2014 at 12:27pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/sajid_dayer/default.htm"><b>sajid dayer</b> (21)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767531">
so you are saying that here the virtual concept is working <br>
so it  invoke to drive class destructor first <br>
<br>
<br>
<br>
<br>
but as we know that always  that drive class destructor invoke first then base class destructor invoke so base destructor exicute second<br>
so here two concepts work together  <br>
i m  right or wrong ?<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm070b691627" title="Fri, 24 Oct 2014 12:29:30 +0000"></span><script type="text/javascript">WhenId('CH_zTm070b691627');</script><noscript>Oct 24, 2014 at 12:29pm UTC</noscript></span>
<span class="dbtn" id="CH_btn767531"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767532"><span title="767532,99948,1023,5455,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767532" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm17137af449" title="Fri, 24 Oct 2014 12:34:00 +0000"></span><script type="text/javascript">WhenId('CH_zTm17137af449');</script><noscript>Oct 24, 2014 at 12:34pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/miinipaa/default.htm"><b>MiiNiPaa</b> (5455)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767532">
Yes. two concepts at work:<br>
1) Destructors are called from most derived to base<br>
2) Virtual calls call functions corresponding to real type of object, not type of pointer/reference.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767532"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767533"><span title="767533,154725,1023,21,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767533" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm2031e3baaa" title="Fri, 24 Oct 2014 12:39:32 +0000"></span><script type="text/javascript">WhenId('CH_zTm2031e3baaa');</script><noscript>Oct 24, 2014 at 12:39pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/sajid_dayer/default.htm"><b>sajid dayer</b> (21)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767533">
thanks guys 
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767533"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767535"><span title="767535,111189,1023,3222,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767535" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmefb5ed4456" title="Fri, 24 Oct 2014 12:43:43 +0000"></span><script type="text/javascript">WhenId('CH_zTmefb5ed4456');</script><noscript>Oct 24, 2014 at 12:43pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/keskiverto/default.htm"><b>keskiverto</b> (3222)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767535">
You might be mixing two things.  The virtual function system does select during runtime <i>which</i> function is called, but <i>what</i> that function does is an another matter.<br>
<br>
<br>
Here is a simple case to show what the function does:<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br></code></pre></td>
<td class="source"><pre><code><dfn>#include &lt;iostream&gt;</dfn>
<var>using</var> std::cout;

<var>class</var> Base
{
<var>public</var>:
  Base() { cout &lt;&lt; <kbd>"Calling Base()\n"</kbd>; }
  ~Base() { cout &lt;&lt; <kbd>"Calling ~Base()\n"</kbd>; }
};

<var>class</var> Derived : <var>public</var> Base
{
<var>public</var>:
  Derived() { cout &lt;&lt; <kbd>"Calling Derived()\n"</kbd>; }
  ~Derived() { cout &lt;&lt; <kbd>"Calling ~Derived()\n"</kbd>; }
};

<var>class</var> Bar : <var>public</var> Derived
{
<var>public</var>:
  Bar() { cout &lt;&lt; <kbd>"Calling Bar()\n"</kbd>; }
  ~Bar() { cout &lt;&lt; <kbd>"Calling ~Bar()\n"</kbd>; }
};

<var>int</var> main()
{
  Bar foo;
  cout &lt;&lt; <kbd>"Hello\n"</kbd>;
  <var>return</var> 0;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
The construction and destruction of derived class objects has its rules.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767535"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767537"><span title="767537,154725,1023,21,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767537" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmc36ca657df" title="Fri, 24 Oct 2014 12:53:32 +0000"></span><script type="text/javascript">WhenId('CH_zTmc36ca657df');</script><noscript>Oct 24, 2014 at 12:53pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/sajid_dayer/default.htm"><b>sajid dayer</b> (21)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767537">
thanks buddy for your example
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767537"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767541"><span title="767541,52082,1023,453,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767541" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm25414ac1af" title="Fri, 24 Oct 2014 13:16:51 +0000"></span><script type="text/javascript">WhenId('CH_zTm25414ac1af');</script><noscript>Oct 24, 2014 at 1:16pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/doug4/default.htm"><b>doug4</b> (453)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767541">
The virtual destructor, however, is the more interesting case.<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br></code></pre></td>
<td class="source"><pre><code><dfn>#include &lt;iostream&gt;</dfn>
<var>using</var> std::cout;

<var>class</var> Base
{
<var>public</var>:
  Base() { cout &lt;&lt; <kbd>"Calling Base()\n"</kbd>; }
  <cite>/* virtual */</cite> ~Base() { cout &lt;&lt; <kbd>"Calling ~Base()\n"</kbd>; }
};

<var>class</var> Derived : <var>public</var> Base
{
<var>public</var>:
  Derived() { cout &lt;&lt; <kbd>"Calling Derived()\n"</kbd>; }
  ~Derived() { cout &lt;&lt; <kbd>"Calling ~Derived()\n"</kbd>; }
};

<var>class</var> Bar : <var>public</var> Derived
{
<var>public</var>:
  Bar() { cout &lt;&lt; <kbd>"Calling Bar()\n"</kbd>; }
  ~Bar() { cout &lt;&lt; <kbd>"Calling ~Bar()\n"</kbd>; }
};

<var>int</var> main()
{
  Base* foo = <var>new</var> Bar;
  cout &lt;&lt; <kbd>"Hello\n"</kbd>;
  <var>delete</var> foo;
  <var>return</var> 0;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
Notice in line 27 I made foo a pointer to the base class, but instantiated an object of the derived class "Bar".  By changing the destructor in line 8 from virtual to non-virtual, the behavior of the delete in line 29 changes.  With a virtual destructor, the destructor chain beginning at Bar is called.  Without the virtual destructor, only the "Base" constructor is called.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767541"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767554"><span title="767554,111189,1023,3222,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767554" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmba03c1bb6a" title="Fri, 24 Oct 2014 14:19:14 +0000"></span><script type="text/javascript">WhenId('CH_zTmba03c1bb6a');</script><noscript>Oct 24, 2014 at 2:19pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/keskiverto/default.htm"><b>keskiverto</b> (3222)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767554">
Lets pretend that the class hierarchy is a house. Base is the roof, Derived is the walls of the rooms, and Bar is the furniture.<br>
<br>
Create a Bar:<br>
1. Hoist the roof.<br>
2. Add the walls.<br>
3. Place the chairs.<br>
<br>
Remove Bar (virtual):<br>
1. Take out the furniture.<br>
2. Remove (internal) walls.<br>
3. Demolish the roof.<br>
The house is no more.<br>
<br>
Remove Base, non-virtual:<br>
1. Demolish the roof.<br>
The house is no more?
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn767554"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg767570"><span title="767570,52082,1023,453,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg767570" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm78292139e0" title="Fri, 24 Oct 2014 14:55:38 +0000"></span><script type="text/javascript">WhenId('CH_zTm78292139e0');</script><noscript>Oct 24, 2014 at 2:55pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/doug4/default.htm"><b>doug4</b> (453)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i767570">
Just to clean up your analogy a little bit...<br>
<br>
The base class would be RoofedStructure.  It's constructor puts up a roof.<br>
The intermediate class would be House.  A House is a RoofedStructure, and its constructor first calls the RoofedStructure constructor and then adds walls.<br>
The bottom class would be FurnishedHouse.  A FurnishedHouse is a House that contains furniture.  The constructor first calls the House constructor and then adds furniture.<br>
<br>
That being said, your conclusion is CORRECT.  This is why it is critical to make destructors virtual in classes that are intended to be base classes.  If the base class has a non-virtual destructor and the derived classes have resources that need to be cleaned up, if you delete a pointer to the base class, the derived class resources will not get cleaned up properly.<br>
<br>
<small>Edit: Fixed it's/its typo.</small>
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm69ee03cbd9" title="Fri, 24 Oct 2014 14:56:40 +0000"></span><script type="text/javascript">WhenId('CH_zTm69ee03cbd9');</script><noscript>Oct 24, 2014 at 2:56pm UTC</noscript></span>
<span class="dbtn" id="CH_btn767570"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Registered users can post here. <a href="../../../user/default.htm">Sign in or register</a> to post.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(145810,0,154725,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','../../thread.cgi','../../post.cgi','../../myposts.cgi.htm',64,32,512,256,1024,16);</script></div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7973859818";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="../../../default.htm">C++</a></b></h3>
<ul>
<li class="folder info"><a href="../../../info/default.htm">Information</a></li>
<li class="folder doc"><a href="../../../doc/default.htm">Tutorials</a></li>
<li class="folder reference"><a href="../../../reference/default.htm">Reference</a></li>
<li class="folder articles"><a href="../../../articles/default.htm">Articles</a></li>
<li class="folder selected forum"><a href="../../default.htm">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="../../default.htm">Forum</a></b></h3>
<ul>
<li><a href="../../beginner/default.htm"><b>Beginners</b></a></li><li><a href="../../windows/default.htm"><b>Windows Programming</b></a></li><li><a href="../../unices/default.htm"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="../default.htm"><b>General C++ Programming</b></a></li><li><a href="../../lounge/default.htm"><b>Lounge</b></a></li><li><a href="../../jobs/default.htm"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="../../../default.htm">Home page</a> | <a href="../../../privacy.do.htm">Privacy policy</a><br>&copy; cplusplus.com, 2000-2014 - All rights reserved - <i>v3.1</i><br><a href="../../../contact.doreferrerwww.cplusplus~377.com_">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="../../../user/default.htm">'+us.user+'</a></b></h3><ul><li><a href="../../myposts.cgi.htm">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? '../../../../httpsssl/default.htm' : '../../../../www/default.htm') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>