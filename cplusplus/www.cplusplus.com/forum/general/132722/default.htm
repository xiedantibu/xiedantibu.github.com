<!DOCTYPE html><!-- saved from url=(0057)http://www.cplusplus.com/forum/general/132722/default.htm --><meta http-equiv="X-UA-Compatible" content="IE=Edge" />

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>I/O Text file handling and dynamic memor - C++ Forum</title>
<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico">
<link rel="stylesheet" type="text/css" href="../../../v321/main.css">
<script src="../../../v321/main.js" type="text/javascript"></script>
</head>
<body>
<div id="I_top">
<div id="I_header">
<div id="I_logo"><a href="../../../default.htm" title="cplusplus.com"><div></div></a></div>
<div id="I_search">
<form id="search" action="/search.do" method="get">
Search: <input name="q" size="20" class="txt"> <input type="submit" value="Go" class="btn">
</form>
</div>
<div id="I_bar">
<ul>
<li><a href="../../default.htm">Forum</a></li>
<li><a href="../default.htm">General C++ Programming</a></li>
<li class="here">I/O Text file handling and dynamic memor</li>
</ul>
</div>
<div id="I_user" class="C_LoginBox"><span title="ajax"></span></div>
</div>
</div>
<div id="I_mid">
<div id="I_wrap">
<div id="I_minheight"></div>
<div id="I_main">
<div class="C_support"><script type="text/javascript"><!--
if (!cookieGet("hspt31")) {
  document.write('<div class="C_DonateBox"></div>');
}
//-->
</script><div class="C_ad728"><script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7973859818";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div><div class="C_supportbottom"></div></div><div id="I_content">
<h3><div class="C_ico question" title="question">&nbsp;</div> I/O Text file handling and dynamic memory allocation</h3><span id="CH_edttl"></span><span class="rootdatPost" title="132722,root,0,-1,16,0"></span><div id="CH_PostList"><div class="C_forPost" id="msg713659"><span title="713659,78412,1023,18,1"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg713659" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm92ff584d26" title="Mon, 19 May 2014 22:57:39 +0000"></span><script type="text/javascript">WhenId('CH_zTm92ff584d26');</script><noscript>May 19, 2014 at 10:57pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i713659">
Hi,<br>
I am working on an OOP assignment (text handler) which part of its description is:<br>
Some lines of text as a story which the delimiter between each story is %%%%%<br>
Each text loaded should only occupy the space needed for the text to fit. <br>
<br>
It's required to use dynamic variables of type char*. To be more detailed, the text-handler must contain a vector of such char-pointers (i.e. c-strings), and the parameter in the constructor indicates how many pointers (c-strings) to be contained in the vector. Each loaded text will be represented by a number, so that the first text in the file gets number 0 and the next one gets number 1 ... etc. When you want to access a text, you request the text with a certain number, and then get a pointer in return that may be used to output the text on the screen.<br>
<br>
My problem is first to allocate a dynamic memory like char** without defining the number of array elements (Each text loaded should only occupy the space needed for the text to fit. )and then store each story from text file (comprise of a few lines of text) into that dynamically located memory(char **)to be able to do some operation on it later.<br>
<br>
may somebody help me in this regard.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn713659"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg713679"><span title="713679,140623,1023,431,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg713679" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm9c10a5a939" title="Tue, 20 May 2014 00:15:14 +0000"></span><script type="text/javascript">WhenId('CH_zTm9c10a5a939');</script><noscript>May 20, 2014 at 12:15am UTC</noscript></div>
<div class="dwho"><a href="../../../user/yay295/default.htm"><b>Yay295</b> (431)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i713679">
I would probably read the file line by line into a std::string, use .size() to get its length, and then allocate a c-string of appropriate length. You could also read the file char by char and keep track of how many you're read in before you hit a new line.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn713679"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg713810"><span title="713810,78412,1023,18,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg713810" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm8d80ecfb04" title="Tue, 20 May 2014 10:01:42 +0000"></span><script type="text/javascript">WhenId('CH_zTm8d80ecfb04');</script><noscript>May 20, 2014 at 10:01am UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i713810">
may you give a more specific hint for the case of char by char with a code snippet please!?<br>
In fact the problem of allocating dynamic memory for reading character by character of a few lines together is still remained.<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm60650ac29e" title="Tue, 20 May 2014 10:10:26 +0000"></span><script type="text/javascript">WhenId('CH_zTm60650ac29e');</script><noscript>May 20, 2014 at 10:10am UTC</noscript></span>
<span class="dbtn" id="CH_btn713810"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg713862"><span title="713862,34800,1023,1602,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg713862" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmd418974187" title="Tue, 20 May 2014 13:36:29 +0000"></span><script type="text/javascript">WhenId('CH_zTmd418974187');</script><noscript>May 20, 2014 at 1:36pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/fun2code/default.htm"><b>fun2code</b> (1602)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i713862">
From the directions:<table class="quote"><tr><td class="qd"> the parameter in the constructor indicates how many pointers (c-strings) to be contained in the vector. </td></tr></table><br>
Perhaps something like:<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br></code></pre></td>
<td class="source"><pre><code><var>class</var> TH<cite>// text handler</cite>
{
    <var>private</var>:
    <var>int</var> numLines;
    <var>char</var>** theLines;
    <var>public</var>:
    TH( <var>int</var> NumLines ): numLines(NumLines), theLines(<var>new</var> <var>char</var>*[NumLines]) {}
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
That gets the pointers allocated but each pointer points to nothing yet.<br>
I would also read the lines from the file in the constructor by passing the file name too. This may violate instructions though. It says ONE parameter for the constructor.<br>
You could have a 2nd function do the file reading. Check the assignment requirements for how you are expected to do this.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn713862"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg713939"><span title="713939,78412,1023,18,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg713939" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm12bc48685b" title="Tue, 20 May 2014 17:22:06 +0000"></span><script type="text/javascript">WhenId('CH_zTm12bc48685b');</script><noscript>May 20, 2014 at 5:22pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i713939">
The constructor will take two parameters â€“ the first parameter should be the name of the text file and the second parameter tells the maximum number of texts to be hold by the texthandler.<br>
<br>
But actually my problem is here: (assume it is inside the constructor of my class, although for ease of testing its functionality I am working on it in a test project, inside the int main() ):<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br></code></pre></td>
<td class="source"><pre><code>ifstream infile;
    infile.open(<kbd>"Stories.txt"</kbd>);<cite>//open the text file</cite>
	 <var>if</var> (!infile)
	{
		cout &lt;&lt; <kbd>"Unable to open file"</kbd>;
		exit(1); <cite>// terminate with error</cite>
    }
	 <var>int</var> ind = 0;
	 <var>const</var> <var>int</var> MaxNoStories = 40;
	 <var>char</var> **myStories = <var>new</var> <var>char</var> *[MaxNoStories];
	 <var>int</var> StoryNo = 0;
	 <var>char</var> str;
	 <var>int</var> i=0;
	 
	 <var>char</var> a;
            <var>while</var>(!infile.eof())
            {
				infile &gt;&gt; str;
				<var>if</var>( str == <kbd>'%'</kbd>){
					ind++;
					<var>if</var>(ind==5){
						cout&lt;&lt;<kbd>"\n\n"</kbd>;  <cite>//separate the stories from each other </cite>
						cout&lt;&lt;<kbd>"Story Number: "</kbd>&lt;&lt; ++StoryNo &lt;&lt; endl;
						i=0;
					}
						
				}
             	<var>else</var>{
					ind=0;
					myStories[StoryNo][i++] = str; <cite>//PROBLEM IS HERE!!</cite>
				}
            }</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
in the line which I marked it as "//PROBLEM IS HERE!!", I have the real problem of my this section. I do not how put the characters which I read in str into my **myStories.<br>
<br>
I have to do some manipulation for each story:<br>
(This is the requirement for the constructor)<br>
<br>
TextHandler object should be able to handle the different fonts used in Windows and the Console window. Once the content is printed in a Console window, most characters works pretty well, but one problem is that the line-break character, used to separate lines in the text file, not at all match the newline character used in the Con-sole window. To solve this, you can read line by line from the text file (use file.getline (...)). Then you get a line of text from the file in the format we call "string", ie. there is a terminat-ing '\0' after the text itself. Replace this character with '\n' which is the newline character used by Console window. Then, you read the next line and add it to the buffer and repeat this until you hit the line with the 5 percent signs. The final character '\0' should then remain, so that the entire buffer is in "string" format. Now, the entire text is in the buffer and can be saved on the next available location in the array with string-pointers (char*), mentioned above.<br>
<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm099c1db39c" title="Tue, 20 May 2014 17:22:38 +0000"></span><script type="text/javascript">WhenId('CH_zTm099c1db39c');</script><noscript>May 20, 2014 at 5:22pm UTC</noscript></span>
<span class="dbtn" id="CH_btn713939"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg713987"><span title="713987,34800,1023,1602,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg713987" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm5303ab1fef" title="Tue, 20 May 2014 19:07:30 +0000"></span><script type="text/javascript">WhenId('CH_zTm5303ab1fef');</script><noscript>May 20, 2014 at 7:07pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/fun2code/default.htm"><b>fun2code</b> (1602)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i713987">
You can read an entire line at once using cin.getline().<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br></code></pre></td>
<td class="source"><pre><code>ifstream infile;
    infile.open(<kbd>"Stories.txt"</kbd>);<cite>//open the text file</cite>
	 <var>if</var> (!infile)
	{
		cout &lt;&lt; <kbd>"Unable to open file"</kbd>;
		exit(1); <cite>// terminate with error</cite>
    }
	 <var>int</var> ind = 0;
	 <var>int</var> MaxNoStories = 40;<cite>// doesn't need to be constant. This would be one ctor argument</cite>
	 <var>char</var> **myStories = <var>new</var> <var>char</var> *[MaxNoStories];
	 <var>int</var> StoryNo = 0;
         <var>char</var> line[1000];<cite>// for each line to read into</cite>
	 <var>char</var> buff[1000];<cite>// local array large enough to contain all lines before the line "%%%%%"</cite>
	 <var>int</var> i=0;
         <var>int</var> length = 0;
	 
            <var>while</var>( cin.getline( line, 999 )  )
            {
                 <var>if</var>(  strcmp( line, <kbd>"%%%%%"</kbd> ) != 0 )<cite>// special line not found yet</cite>
                 {
                      strcat( line, buff );<cite>// add content of line to buff</cite>
                      length = strlen( buff );
                      buff[length] = <kbd>'\n'</kbd>;<cite>// change the '\0' to '\n'</cite>
                 }
                 <var>else</var><cite>// copy buff to  myStories[StoryNo]</cite>
                 {                      
                      <cite>// just change that last '\n' back to '\0'</cite>
                      buff[length] = <kbd>'\0'</kbd>;
                      myStories[StoryNo] = <var>new</var> <var>char</var>[length+1];<cite>// exact amount required</cite>
                      strcpy( buff, myStories[StoryNo] );
                      StoryNo++;
                 }
                 
            }</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
Some of the function names may not be quite right (strcmp, strcpy, strlen ), and the argument order may be reversed. It's been years since I've used these methods. Do you mind looking up the details?<br>
<br>
Hope this helps.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn713987"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714297"><span title="714297,78412,1023,18,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714297" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm317e3f4e9c" title="Wed, 21 May 2014 16:20:30 +0000"></span><script type="text/javascript">WhenId('CH_zTm317e3f4e9c');</script><noscript>May 21, 2014 at 4:20pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714297">
Dear fun2code,<br>
your help was really useful and helped me a lot. However,  I worked on it and tried to optimize it more.<br>
here the code is what I have done.<br>
The biggest change was that the first inputted line array should be copied to buff (strcpy) and after that each reading data into line array should be concatenate to buff (strcat)<br>
But still I have some problems which I am writing it down here after showing the code:<br>
<br>
What I have done first is: <br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br></code></pre></td>
<td class="source"><pre><code>ifstream infile;
    infile.open(<kbd>"Stories.txt"</kbd>);<cite>//open the text file</cite>
	 <var>if</var> (!infile)
	{
		cout &lt;&lt; <kbd>"Unable to open file"</kbd>;
		exit(1); <cite>// terminate with error</cite>
    }
	 <var>int</var> ind = 0;
	 <var>int</var> MaxNoStories = 40;<cite>// doesn't need to be constant. This would be one ctor argument</cite>
	 <var>char</var> **myStories = <var>new</var> <var>char</var> *[MaxNoStories];
	 <var>int</var> StoryNo = 0;
     <var>char</var> line[1000];<cite>// for each line to read into</cite>
	 <var>char</var> buff[1000];<cite>// local array large enough to contain all lines before the line "%%%%%"</cite>
	 <var>int</var> i=0;
         <var>int</var> length = 0;
	 <var>bool</var> check = <var>false</var>;
	 strcpy(line,<kbd>" "</kbd>);
	 strcpy(buff,<kbd>" "</kbd>);
	
            <var>while</var>(!infile.eof()){
				infile.getline( line, 500);
				
				 <var>if</var>( strcmp(line, <kbd>"%%%%%"</kbd>) !=0 ){
						line[strlen(line)]=<kbd>'\n'</kbd>; <cite>// PROBLEM 1</cite>
						
						<var>if</var>(check== <var>false</var>){
						    strcpy( buff, line );
                                                    check = <var>true</var>;
						}
					
					       <var>else</var>{
						       strcat( buff, line );
						}
				 }
				<var>else</var>{
				<u>	 myStories[StoryNo]= <var>new</var> <var>char</var> [strlen(buff)];
					 strcpy(myStories[StoryNo], buff);

					 <cite>//cout&lt;&lt; buff&lt;&lt;"\n\n";</cite>
					 <var>for</var>(<var>int</var> j=0;j &lt;strlen(buff);j++)
						 cout&lt;&lt;myStories[StoryNo];</u> <cite>//PROBLEM 2</cite>
					
					 strcpy(buff,<kbd>" "</kbd>);
					 check = <var>false</var>;
					 StoryNo++;
				 }

            }</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
// PROBLEM 1: when I use line[strlen(line)]='\n'; the memory crashes and the \0 null terminator didn't change to newline \n by that line of code, I tried many things, but I cannot understand why it makes the program to crash, although when change it to line[strlen(line)-1]='\n'; it changed the final character of the line and not \0.<br>
<br>
//PROBLEM 2: again putting the data from buff to dynamically allocated memory as myStories[StoryNo] does not work. <br>
<br>
Shouldn't myStories[StoryNo] as a double pointer (char **myStories = new char *[MaxNoStories];) be defined in the while loop as *myStories[StoryNo] = new char *[length+1]; since myStories is a dynamic double pointer????<br>
<br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm27b81e383b" title="Wed, 21 May 2014 16:26:14 +0000"></span><script type="text/javascript">WhenId('CH_zTm27b81e383b');</script><noscript>May 21, 2014 at 4:26pm UTC</noscript></span>
<span class="dbtn" id="CH_btn714297"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714324"><span title="714324,140623,1023,431,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714324" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmdc6ade9778" title="Wed, 21 May 2014 18:04:25 +0000"></span><script type="text/javascript">WhenId('CH_zTmdc6ade9778');</script><noscript>May 21, 2014 at 6:04pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/yay295/default.htm"><b>Yay295</b> (431)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714324">
ANSWER 1: Your string is not null-terminated. line[strlen(line)-1] is the last character, line[strlen(line)] is one character past the last character.<br>
<br>
I don't know about your second problem. I avoid manual dynamic allocation as much as I can.
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn714324"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714333"><span title="714333,78412,1023,18,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714333" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm7a2763a344" title="Wed, 21 May 2014 18:19:19 +0000"></span><script type="text/javascript">WhenId('CH_zTm7a2763a344');</script><noscript>May 21, 2014 at 6:19pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714333">
What do you mean exactly with my string is not null terminated.<br>
To the best of my knowledge when I use infile.getline (line, 1000) for example I create a null terminated string as a C-string. and as you said the last character would be line[strlen(line)]. but it should have a null-termination character in the line array.<br>
Although in this program when I try to change the null-termination \0 with \n (newline) the program crashes. 
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn714333"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714361"><span title="714361,34800,1023,1602,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714361" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm5ab29c0942" title="Wed, 21 May 2014 19:09:11 +0000"></span><script type="text/javascript">WhenId('CH_zTm5ab29c0942');</script><noscript>May 21, 2014 at 7:09pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/fun2code/default.htm"><b>fun2code</b> (1602)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714361">
OK. I tried this myself and found several problems with the code in my previous post.<br>
<br>
Had to wrap my head around exactly what's going on with the '\0' characters.<br>
It's been a while.<br>
We have to be careful about over writing it because it marks end of string.<br>
Your PROBLEM 1 results from trying to copy a string lacking a '\0' character (so it goes forever).<br>
<br>
I think PROBLEM 2 results from the mess created by PROBLEM 1, and being 1 char short in allocation.<br>
<br>
Also, it's OK to strcat to an empty string (so long as buff[0] == '\0'), so the check isn't needed.<br>
<br>
I have the code working. <br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br></code></pre></td>
<td class="source"><pre><code><var>int</var> main()
{
    ifstream infile;
    infile.open(<kbd>"Stories.txt"</kbd>);<cite>//open the text file</cite>
    <var>if</var> (!infile)
    {
	cout &lt;&lt; <kbd>"Unable to open file"</kbd>;
	<var>return</var> 1; <cite>// terminate with error</cite>
    }

    <var>unsigned</var> <var>int</var> MaxNoStories = 40;<cite>// doesn't need to be constant. This would be one ctor argument</cite>
    <var>char</var> **myStories = <var>new</var> <var>char</var> *[MaxNoStories];
    <var>unsigned</var> <var>int</var> StoryNo = 0;
    <var>char</var> line[1000] = {0};<cite>// for each line to read into</cite>
    <var>char</var> buff[1000] = {0};<cite>// local array large enough to contain all lines before the line "%%%%%"</cite>
    <var>unsigned</var> <var>int</var> length = 0;

    <var>while</var>(!infile.eof() &amp;&amp; StoryNo &lt; MaxNoStories)<cite>// watch for end of array too!</cite>
<cite>//    while( infile.getline( line, 500) )</cite>
    {
	infile.getline( line, 500);

	 <var>if</var>( strcmp(line, <kbd>"%%%%%"</kbd>) !=0 )
	{
	    length = strlen(line);
	    line[length] = <kbd>'\n'</kbd>;<cite>// over write the '\0' with '\n'</cite>
	    line[length+1] = <kbd>'\0'</kbd>;<cite>// put '\0' at the end so strcat will work</cite>
	    strcat( buff, line );<cite>// OK to strcat to an empty buff. No need to strcpy 1st time</cite>
       }
        <var>else</var>
	{
	     length = strlen(buff);
	     myStories[StoryNo]= <var>new</var> <var>char</var> [length + 1];<cite>// +1 for the '\0'</cite>
	     strcpy(myStories[StoryNo], buff);
	     StoryNo++;
	     buff[0] = <kbd>'\0'</kbd>;<cite>// reset for the next story. Makes buff appear empty</cite>
	}
    }<cite>// end while</cite>

    <var>for</var>( <var>unsigned</var> i = 0; i &lt; StoryNo; ++i )
        cout &lt;&lt; myStories[i] &lt;&lt; <kbd>"\n\n"</kbd>;

    <var>return</var> 0;
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
I puzzled why the 1st line starts with a space for a while before I finally saw this line:<br>
<span class="auto"><code class="source">strcpy(buff,<kbd>" "</kbd>);</code></span><br>
It isn't needed.<br>
I decided to post my complete code because there are several local variables and some code removed.<br>
I also changed a few variables from type int to unsigned int, to get rid of those pesky "comparison of signed to unsigned" warnings.<br>
<br>
<table class="quote"><tr><td class="qd">Shouldn't myStories[StoryNo] as a double pointer (char **myStories = new char *[MaxNoStories];) be defined in the while loop as *myStories[StoryNo] = new char *[length+1]; since myStories is a dynamic double pointer????<br>
</td></tr></table><br>
No. The use of [] does 2 things. It advances the pointer <i>and</i> dereferences it.<br>
You would have to use the * this way:<br>
 <span class="auto"><code class="source">*(myStories + StoryNo) = <var>new</var> <var>char</var>[length+1];<cite>// not char* </cite></code></span>
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTmf20646fdcb" title="Wed, 21 May 2014 19:23:31 +0000"></span><script type="text/javascript">WhenId('CH_zTmf20646fdcb');</script><noscript>May 21, 2014 at 7:23pm UTC</noscript></span>
<span class="dbtn" id="CH_btn714361"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714373"><span title="714373,78412,1023,18,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714373" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm19e6133c64" title="Wed, 21 May 2014 19:34:22 +0000"></span><script type="text/javascript">WhenId('CH_zTm19e6133c64');</script><noscript>May 21, 2014 at 7:34pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714373">
Dear fun2code,<br>
<br>
Thanks a lot. it was perfect. I understand the problems I made and now it can be compiled and run without an error. Now I can try to tailor it to my class for other functionality.<br>
Thank you so much :)
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn714373"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714387"><span title="714387,34800,1023,1602,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714387" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmd0193dc2a0" title="Wed, 21 May 2014 20:05:53 +0000"></span><script type="text/javascript">WhenId('CH_zTmd0193dc2a0');</script><noscript>May 21, 2014 at 8:05pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/fun2code/default.htm"><b>fun2code</b> (1602)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714387">
You're welcome. Thanks for the archaic methods review!
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn714387"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714593"><span title="714593,78412,1023,18,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714593" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm30858dd50a" title="Thu, 22 May 2014 10:39:32 +0000"></span><script type="text/javascript">WhenId('CH_zTm30858dd50a');</script><noscript>May 22, 2014 at 10:39am UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714593">
In the class declaration, I got some errors.<br>
<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br>99<br>100<br>101<br>102<br>103<br>104<br></code></pre></td>
<td class="source"><pre><code><dfn>#include&lt;fstream&gt;</dfn>
<dfn>#include &lt;cstring&gt;</dfn>
<dfn>#include &lt;iostream&gt;</dfn>
<var>using</var> std::cin;
<var>using</var> std::cout;
<var>using</var> std::endl;
<var>using</var> std::ifstream;


<var>class</var> Texthandler
{
	<var>int</var> TotStoriesinFile;
    <var>int</var> MaxNoStories;<cite>// doesn't need to be constant. This would be one ctor argument</cite>
    <var>char</var> **myStories;
    <var>unsigned</var> <var>int</var> StoryNo;
    <var>char</var> line[1000];<cite>// for each line to read into</cite>
    <var>char</var> buff[1000];<cite>// local array large enough to contain all lines before the line "%%%%%"</cite>
    <var>unsigned</var> <var>int</var> length;
	<var>char</var> FileName[100];
<var>public</var>:
	Texthandler(<var>char</var> *str, <var>int</var> Nr);		<cite>// Constructor</cite>
	~Texthandler();		<cite>// Destructor</cite>
	<var>int</var> nrOfTexts();
	<var>int</var> maxNrOfTexts();
	<var>const</var> <var>char</var>* text(<var>int</var> txtnr);
};

Texthandler::Texthandler(<var>char</var> *str, <var>int</var> Nr){ 
	
	<var>int</var> TotStoriesinFile = 0;
    <var>int</var> MaxNoStories = Nr;<cite>// doesn't need to be constant. This would be one ctor argument</cite>
    <var>char</var> **myStories = <var>new</var> <var>char</var> *[MaxNoStories];
    <var>unsigned</var> <var>int</var> StoryNo = 0;
    <var>char</var> line[1000] = {0};<cite>// for each line to read into</cite>
    <var>char</var> buff[1000] = {0};<cite>// local array large enough to contain all lines before the line "%%%%%"</cite>
    <var>unsigned</var> <var>int</var> length = 0;
	
	ifstream infile;
    infile.open(str);<cite>//open the text file</cite>

    <var>while</var>(!infile.eof()){
		infile.getline( line, 1000);

		 <var>if</var>( strcmp(line, <kbd>"%%%%%"</kbd>) !=0 ){
			length = strlen(line);
			line[length] = <kbd>'\n'</kbd>;<cite>// over write the '\0' with '\n'</cite>
			line[length+1] = <kbd>'\0'</kbd>;<cite>// put '\0' at the end so strcat will work</cite>
			strcat( buff, line );<cite>// OK to strcat to an empty buff. No need to strcpy 1st time</cite>
		   }
		<var>else</var> <var>if</var> ((strcmp(line, <kbd>"%%%%%"</kbd>) == 0) &amp;&amp; (strlen(buff)!=0) ){
			 length = strlen(buff);
			 myStories[StoryNo]= <var>new</var> <var>char</var> [length + 1];<cite>// +1 for the '\0'</cite>
			 strcpy(myStories[StoryNo], buff);
			 StoryNo++;
			 buff[0] = <kbd>'\0'</kbd>;<cite>// reset for the next story. Makes buff appear empty</cite>
		}
    }<cite>// end while</cite>
	TotStoriesinFile = StoryNo;

	<cite>//for( unsigned i = 0; i &lt; StoryNo; ++i ){</cite>
	<cite>//	cout&lt;&lt;"Text nr "&lt;&lt; i+1&lt;&lt;" contains "&lt;&lt; strlen(myStories[i])&lt;&lt;" characters.\n";</cite>
	<cite>//	cout&lt;&lt;"-------------------------------------------------------------------\n";</cite>
 <cite>//       cout &lt;&lt; myStories[i] &lt;&lt; "\n\n";</cite>
	<cite>//}</cite>
}


<var>int</var> Texthandler::nrOfTexts(){

	<var>return</var> TotStoriesinFile;
}

<var>int</var> Texthandler::maxNrOfTexts(){
	<var>return</var> MaxNoStories;
}

<var>const</var> <var>char</var>* Texthandler::text(<var>int</var> txtnr){
	<var>char</var> * str= <var>new</var> <var>char</var> [strlen(myStories[txtnr])];

	<var>if</var>((txtnr&gt;0) &amp;&amp; (txtnr&lt;MaxNoStories)){
		str = myStories[txtnr];
		<var>return</var> str;
	}
	<var>else</var>
		<var>return</var> NULL;
}

Texthandler::~Texthandler(){
	
	<var>for</var>(<var>int</var> i=0;i&lt;MaxNoStories;i++)
		<var>delete</var> [] myStories[i];
	<var>delete</var> [] myStories;
}



<var>int</var> main(){
	<var>int</var> maximalNumberOfTexts = 20;
	Texthandler th(<kbd>"Stories.txt"</kbd>, maximalNumberOfTexts);
	cout&lt;&lt; th.text(4);
	cout&lt;&lt; <kbd>"\n\n\ntest to pass constructor\n\n\n"</kbd>;
	cout&lt;&lt;th.maxNrOfTexts();
	th.~Texthandler();
}</code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
<br>
When I try to return the value of two private variable which has got its value from the constructor from two member functions:<br>
int Texthandler::nrOfTexts(){<br>
<br>
	return TotStoriesinFile;<br>
}<br>
<br>
int Texthandler::maxNrOfTexts(){<br>
	return MaxNoStories;<br>
}<br>
<br>
I get garbage on the screen, and I cannot understand why?<br>
<br>
after calling the member function:<br>
const char* Texthandler::text(int txtnr){<br>
	char * str= new char [strlen(myStories[txtnr])];<br>
<br>
	if((txtnr&gt;0) &amp;&amp; (txtnr&lt;MaxNoStories)){<br>
		str = myStories[txtnr];<br>
		return str;<br>
	}<br>
	else<br>
		return NULL;<br>
}<br>
<br>
why does the program crash??
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn714593"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714666"><span title="714666,34800,1023,1602,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714666" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm3b4e2e3634" title="Thu, 22 May 2014 13:59:00 +0000"></span><script type="text/javascript">WhenId('CH_zTm3b4e2e3634');</script><noscript>May 22, 2014 at 1:59pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/fun2code/default.htm"><b>fun2code</b> (1602)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714666">
You've declared several variables as both members of the class and as local variables within the ctor (constructor). Probably the local vars are getting set in the ctor, not the data members.<br>
<br>
I think the data members should be:<br>
<div class="auto"><table class="snippet"><tr><td class="rownum"><pre><code>1<br>2<br>3<br>4<br>5<br></code></pre></td>
<td class="source"><pre><code><var>int</var> MaxNoStories;<cite>// can this be negative? Declare as unsigned int</cite>
<var>char</var> **myStories;
<var>unsigned</var> <var>int</var> StoryNo;<cite>// maybe ActualNoStories would be a better name.</cite>
<cite>// NO OTHER VARIABLES as data members</cite>
<cite>// DO NOT declare these as local vars in the ctor </cite></code></pre></td><td class="C_btnholder"></td></tr></table></div>
<br>
The rest are local variables in the ctor. Their sole purpose is helping to get the Texthandler constructed.<br>
<br>
EDIT: The filename should be passed as a const char*<br>
<span class="auto"><code class="source">Texthandler::Texthandler(<var>const</var> <var>char</var> *str, <var>int</var> Nr)</code></span><br>

</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm983d3dd330" title="Thu, 22 May 2014 14:24:07 +0000"></span><script type="text/javascript">WhenId('CH_zTm983d3dd330');</script><noscript>May 22, 2014 at 2:24pm UTC</noscript></span>
<span class="dbtn" id="CH_btn714666"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714674"><span title="714674,78412,1023,18,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714674" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTmc11343e776" title="Thu, 22 May 2014 14:15:09 +0000"></span><script type="text/javascript">WhenId('CH_zTmc11343e776');</script><noscript>May 22, 2014 at 2:15pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/manp/default.htm"><b>manp</b> (18)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714674">
Yeah, You were right. The problem was for double declaration. and since I update the variable for the second declaration it couldn't be return as the value for the member variable and then it returned just garbage as the value inside uninitialized member variable of the class (Although it cannot be initialized basically).<br>
The problem was solved :) 
</div>
<div class="dhow">
<span class="dbtn" id="CH_btn714674"></span>

</div>
</div>
</div>
<div class="C_forPost" id="msg714728"><span title="714728,34800,1023,1602,0"></span>
<div class="box">
<div class="boxtop">
<div class="dwhen"><a href="#msg714728" title="Link to this post"><img src="../../../img/link.png" width="16" height="8"></a> <span id="CH_zTm41a938af22" title="Thu, 22 May 2014 16:35:58 +0000"></span><script type="text/javascript">WhenId('CH_zTm41a938af22');</script><noscript>May 22, 2014 at 4:35pm UTC</noscript></div>
<div class="dwho"><a href="../../../user/fun2code/default.htm"><b>fun2code</b> (1602)</a></div>
</div>
<div class="dwhat" colspan="2" id="CH_i714728">
I'm glad that solved the problem.<br>
Maybe re read the chapter on classes.
</div>
<div class="dhow">
<span class="sedited">Last edited on <span id="CH_zTm487ad22bb9" title="Fri, 23 May 2014 16:36:49 +0000"></span><script type="text/javascript">WhenId('CH_zTm487ad22bb9');</script><noscript>May 23, 2014 at 4:36pm UTC</noscript></span>
<span class="dbtn" id="CH_btn714728"></span>

</div>
</div>
</div>
</div><div class="rootinsMore"></div><div class="rootbtnMore"></div><div class="rootinsNew"></div><div class="rootbtnNew"></div><div id="CH_insNew"></div><div id="CH_reply">Topic archived. No new replies allowed.</div><div id="CH_subscription"></div><div class="rootedtNew"></div><script type="text/javascript">new for_PostList(132722,1,78412,0,'CH_PostList','CH_subscription','CH_reply','CH_insNew','CH_edttl','../../thread.cgi','../../post.cgi','../../myposts.cgi.htm',64,32,512,256,1024,16);</script></div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7973859818";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script></div>
<div id="I_nav">
<div class="sect root">
<h3><b><a href="../../../default.htm">C++</a></b></h3>
<ul>
<li class="folder info"><a href="../../../info/default.htm">Information</a></li>
<li class="folder doc"><a href="../../../doc/default.htm">Tutorials</a></li>
<li class="folder reference"><a href="../../../reference/default.htm">Reference</a></li>
<li class="folder articles"><a href="../../../articles/default.htm">Articles</a></li>
<li class="folder selected forum"><a href="../../default.htm">Forum</a></li>
</ul>
</div>
<div class="sect">
<h3><b><a href="../../default.htm">Forum</a></b></h3>
<ul>
<li><a href="../../beginner/default.htm"><b>Beginners</b></a></li><li><a href="../../windows/default.htm"><b>Windows Programming</b></a></li><li><a href="../../unices/default.htm"><b>UNIX/Linux Programming</b></a></li><li class="selected"><a href="../default.htm"><b>General C++ Programming</b></a></li><li><a href="../../lounge/default.htm"><b>Lounge</b></a></li><li><a href="../../jobs/default.htm"><b>Jobs</b></a></li></ul>
</div>
<div id="I_subnav"></div>
<div class="C_ad234">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-7688470879129516";
google_ad_slot = "7445514729";
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<acript type="text/javascript"
src="../../../../pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div></div>
<div id="I_midclear"></div>
</div>
</div>
<div id="I_bottom">
<div id="I_footer">
	<a href="../../../default.htm">Home page</a> | <a href="../../../privacy.do.htm">Privacy policy</a><br>&copy; cplusplus.com, 2000-2014 - All rights reserved - <i>v3.1</i><br><a href="../../../contact.doreferrerwww.cplusplus~362.com_">Spotted an error? contact us</a>
</div>
</div>

<script type="text/javascript">
<!--
function NavFor(us) {document.getElementById('I_subnav').innerHTML=us.ok?'<div class="sect"><h3><b><a href="../../../user/default.htm">'+us.user+'</a></b></h3><ul><li><a href="../../myposts.cgi.htm">My topics</a></li></ul></div>':'';}onSession(NavFor);ready();
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-521783-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? '../../../../httpsssl/default.htm' : '../../../../www/default.htm') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//-->
</script>

</body>
</html>