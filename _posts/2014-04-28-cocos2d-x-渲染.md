---
layout: post
title: "cocos2d-x 渲染"
category : cocos2d-x
tagline: "转载本站文章请注明作者和出处"
tags : [cocos2d-x]
---
{% include JB/setup %}

本文主要针对于2.2.3 cocos2d-x渲染做一分析，TestCpp ios项目启动,⾸先运行的当然就是main.m这个类了啊    
    
    main(int argc, char *argv[]) {
    
        NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];
    	int retVal = UIApplicationMain(argc, argv, nil, @"AppController");
    	[pool release];
    	return retVal;
       
    }

现在跟进到AppController,这里的AppController并不是cocos2d-x中的AppController，而是ios项目中的，找到`- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions`方法,在该方法中有这么一句话`cocos2d::CCApplication::sharedApplication()->run()`，好了咱得去找CCApplication了。  
#####CCApplication run方法中  

	int CCApplication::run()
	{
    	if (applicationDidFinishLaunching()) 
    	{
        	[[CCDirectorCaller sharedDirectorCaller] startMainLoop];//启动了线程
   	 	}
    	return 0;
	}  
#####跟进到startMainLoop中

	[displayLink invalidate];
    displayLink = nil;
    //实例化CADisplayLink
    displayLink = [NSClassFromString(@"CADisplayLink") displayLinkWithTarget:self  selector:@selector(doCaller:)];//回调doCaller:
    [displayLink setFrameInterval: self.interval];
    [displayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSDefaultRunLoopMode];

CADisplayLink是一个能让我们以和屏幕刷新率同步的频率将特定的内容画到屏幕上的定时器类。CADisplayLink以特定模式注册到runloop后，每当屏幕显示内容刷新结束的时候，runloop就会向CADisplayLink指定的target发送一次指定的selector消息， CADisplayLink类对应的selector就会被调用一次。  

在doCaller:这个回调方法中，也就这么一句话`cocos2d::CCDirector::sharedDirector()->mainLoop()`,终于找到了党，CCDirector熟悉了吧。